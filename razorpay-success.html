<script>
/* 1️⃣ pull them out of the URL */
const qs     = new URLSearchParams(location.search);
const payId  = qs.get('razorpay_payment_id');
const ordId  = qs.get('razorpay_order_id');
const sign   = qs.get('razorpay_signature');

/* 2️⃣ gather whatever you stored locally before redirecting */
const local  = JSON.parse(sessionStorage.getItem('pendingOrder') || '{}');

/* 3️⃣ fire the serverless function that does the real work */
fetch('/.netlify/functions/verify-signature', {
  method : 'POST',
  headers: { 'Content-Type': 'application/json' },
  body   : JSON.stringify({
    payId, ordId, sign,              //  ← the three critical fields
    ...local                         //  ← cart, uid, address, totals, …
  })
})
.then(() => {
  sessionStorage.removeItem('pendingOrder');
  // optional: show a “Thank‑you” message or bounce home
  location.href = '/#paymentSuccess';
})
.catch(() => location.href = '/#paymentError');
</script>
