<script>
  const local = JSON.parse(sessionStorage.getItem("pendingOrder") || "{}");
  const q     = new URLSearchParams(location.search);

  fetch("/.netlify/functions/verify-signature", {
    method : "POST",
    headers: { "Content-Type":"application/json" },
    body   : JSON.stringify({
      payId : q.get("razorpay_payment_id"),
      ordId : q.get("razorpay_order_id"),
      sign  : q.get("razorpay_signature"),
      ...local                          // cart, addr, uid, totals
    })
  })
  .then(() => location.href = "/#paymentSuccess")
  .catch(() => location.href = "/#paymentError");
</script>
